---
  - name: Clone PAMM seed repository version {{ pamm_seed_tag }}
    git:
      repo: "{{ group_pamm_seed_repo }}"
      dest: /home/{{gogs_user}}/gogs-repositories/pamm.seed
      version: "{{ pamm_seed_tag }}"

  - name: Change owner of PAMM seed repository
    file:
      path: "/home/{{gogs_user}}/gogs-repositories/pamm.seed"
      owner: "{{gogs_user}}"
      group: "{{gogs_group}}"
      recurse: yes

  - name: Copy PAMM seed import scripts
    copy:
      src: "{{ item }}"
      dest: "/{{ item }}"
      mode: 0755
    with_items:
      - import_pamm_seed.sh
      - import_pamm_seed_no_history.sh

  - name: Import PAMM seed into GOGS
    shell: /import_pamm_seed.sh
    ignore_errors: yes
    register: result

  - name: Import PAMM seed into GOGS (no history)
    shell: /import_pamm_seed_no_history.sh
    when: result.rc != 0

  - name: Remove PAMM seed import scripts
    file:
      path: "{{ item }}"
      state: absent
    with_items:
      - import_pamm_seed.sh
      - import_pamm_seed_no_history.sh
